<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Statically Import Utility Functions • staticimports</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Statically Import Utility Functions">
<meta property="og:description" content="Provides utility functions that can be copied into another package.
     Other packages do not need to take a dependency on staticimports; the
     functions can be copied to the R/ directory of the package.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">staticimports</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/speed_tests.html">Speed tests</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="staticimports">staticimports<a class="anchor" aria-label="anchor" href="#staticimports"></a>
</h1></div>
<!-- badges: start -->
<p>staticimports makes it easy to statically import functions into R projects or packages. The “static” importing means that the functions are copied into the project as text, instead of being loaded from a separate package at run time.</p>
<p>The benefits of doing things this way:</p>
<ul>
<li>A project or package that uses staticimports will not take a run-time dependency on the staticimports package.</li>
<li>Statically imported functions will not change underneath you unexpectedly. They only will change when you re-import them, and then you can inspect the diff for changes that may cause problems.</li>
<li>You can specify the individual functions to import. This is faster and lighter-weight than loading a separate package, especially if the package has much more functionality than you need.</li>
<li>There is zero commitment: After you use staticimports once, you never have to use it again. You can even move the imported functions out to other files and treat them like any other functions in your project.</li>
</ul>
<p>Where can statically imported functions come from?</p>
<ul>
<li>Any package with an <code>inst/staticexports/</code> directory. This includes the staticimports package itself, which contains many utility functions in <a href="https://github.com/wch/staticimports/tree/main/inst/staticexports" class="external-link"><code>inst/staticexports/</code></a>.</li>
<li>A local directory on your computer. For example, you may maintain your own set of functions that you can statically import into a project.</li>
<li>(Not implemented yet) A directory in a remote Git repository.</li>
</ul>
<p>Instead of copying and pasting utility functions from project to project, the utility functions can be centralized in a place where they can be vetted and tested.</p>
<p>The functions in staticimports are designed to be:</p>
<ul>
<li>Fast</li>
<li>Simple</li>
<li>Have no external dependencies</li>
</ul>
<p>If your project imports a function from staticimports, and that function changes in a way that has a negative impact on your project, you can simply stop importing it from staticimports, and copy the old version to a separate file.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of staticimports with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"wch/staticimports"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>To use, put a comment block starting with <code># @staticimports</code> in one of your R source files. For example, your <code>utils.R</code> may have this at the top:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># @staticimports pkg:staticimports</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#  os_name %||%</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#  map walk</span></span></code></pre></div>
<p>The <code>pkg:staticimports</code> tells it to import from staticimports package. To import from a different package, use <code>pkg:mypackage</code>. It looks in a directory of the package named <a href="https://github.com/wch/staticimports/tree/main/inst/staticexports" class="external-link"><code>staticexports</code></a> to find the objects. To import from a local absolute or relative path, you can use something like <code>@staticimports ../r_utils/</code>.</p>
<p>The following lines name the objects to import from the source. In this case, they are <code>os_name</code>, <code>%||%</code>, <code>map</code>, and <code>walk</code>.</p>
<p>To perform the import, run:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wch.github.io/staticimports">staticimports</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/import.html">import</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>By default this will write the functions to a file <code>R/staticimports.R</code> in your project.</p>
<p>You examine the output by writing to <code><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stdout()</a></code> instead of <code>R/staticimports.R</code>. Notice how importing <code>os_name</code> automatically brings in <code>is_windows</code>, <code>is_mac</code>, and <code>is_linux</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/import.html">import</a></span><span class="op">(</span>outfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stdout</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">#&gt; # Generated by staticimports; do not edit by hand.</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">#&gt; # ======================================================================</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt; </span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#&gt; `%||%` &lt;- function(a, b) {</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt;   if (is.null(a)) b else a</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt; }</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; </span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; is_linux   &lt;- function() Sys.info()[['sysname']] == 'Linux'</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt; </span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; is_mac     &lt;- function() Sys.info()[['sysname']] == 'Darwin'</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; </span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt; is_windows &lt;- function() .Platform$OS.type == "windows"</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">#&gt; </span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co">#&gt; map &lt;- function(.x, .f, ...) {</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">#&gt;   lapply(.x, .f, ...)</span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="co">#&gt; }</span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="co">#&gt; </span></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="co">#&gt; os_name &lt;- function() {</span></span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="co">#&gt;   if (is_windows()) {</span></span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="co">#&gt;     "win"</span></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="co">#&gt;   } else if (is_mac()) {</span></span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="co">#&gt;     "mac"</span></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="co">#&gt;   } else if (is_linux()) {</span></span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="co">#&gt;     "linux"</span></span>
<span id="cb5-25"><a href="#cb5-25"></a><span class="co">#&gt;   } else if (.Platform$OS.type == "unix") {</span></span>
<span id="cb5-26"><a href="#cb5-26"></a><span class="co">#&gt;     "unix"</span></span>
<span id="cb5-27"><a href="#cb5-27"></a><span class="co">#&gt;   } else {</span></span>
<span id="cb5-28"><a href="#cb5-28"></a><span class="co">#&gt;     "unknown"</span></span>
<span id="cb5-29"><a href="#cb5-29"></a><span class="co">#&gt;   }</span></span>
<span id="cb5-30"><a href="#cb5-30"></a><span class="co">#&gt; }</span></span>
<span id="cb5-31"><a href="#cb5-31"></a><span class="co">#&gt; </span></span>
<span id="cb5-32"><a href="#cb5-32"></a><span class="co">#&gt; walk &lt;- function(.x, .f, ...) {</span></span>
<span id="cb5-33"><a href="#cb5-33"></a><span class="co">#&gt;   for (i in seq_along(.x)) {</span></span>
<span id="cb5-34"><a href="#cb5-34"></a><span class="co">#&gt;     .f(.x[[i]], ...)</span></span>
<span id="cb5-35"><a href="#cb5-35"></a><span class="co">#&gt;   }</span></span>
<span id="cb5-36"><a href="#cb5-36"></a><span class="co">#&gt;   NULL</span></span>
<span id="cb5-37"><a href="#cb5-37"></a><span class="co">#&gt; }</span></span></code></pre></div>
<p>For testing what the output will look like, you can use <code><a href="reference/import_objs.html">import_objs()</a></code> to see what it looks like when you import specific objects by name:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/import_objs.html">import_objs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"map"</span>, <span class="st">"walk"</span><span class="op">)</span>, outfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stdout</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Generated by staticimports; do not edit by hand.</span></span>
<span><span class="co">#&gt; # ======================================================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; map &lt;- function(.x, .f, ...) {</span></span>
<span><span class="co">#&gt;   lapply(.x, .f, ...)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; walk &lt;- function(.x, .f, ...) {</span></span>
<span><span class="co">#&gt;   for (i in seq_along(.x)) {</span></span>
<span><span class="co">#&gt;     .f(.x[[i]], ...)</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt;   NULL</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="under-the-hood">Under the hood<a class="anchor" aria-label="anchor" href="#under-the-hood"></a>
</h2>
<p>The functions provided by staticimports are in the <a href="https://github.com/wch/staticimports/tree/main/inst/staticexports" class="external-link">inst/staticexports</a> directory of the repository. When <code><a href="reference/import.html">import()</a></code> is called, it sources all of those files into a new environment. Then it finds all the internal dependencies among those functions. If a function <code>fn_a</code> is requested, and it uses a function <code>fn_b</code>, then both of those functions will be copied to the project.</p>
<p>If a different set of source files is used, it sources all of the files in the target directory into a new environment and then proceeds the same way.</p>
</div>
<div class="section level2">
<h2 id="todo">TODO<a class="anchor" aria-label="anchor" href="#todo"></a>
</h2>
<ul>
<li>Figure out and explain licensing issues.</li>
<li>Write license info in generated file.</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing staticimports</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Winston Chang <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/wch/staticimports/actions" class="external-link"><img src="https://github.com/wch/staticimports/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Winston Chang.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
